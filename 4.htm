<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(to right, #ffebcd, #ffb6c1, #ffc0cb, #ffe4e1, #ffefd5);
            color: #333;
        }
        h1, h2 {
            color: #4b0082;
            text-align: center;
        }
        form {
            margin-bottom: 20px;
            background: #fffafa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        label, input, textarea, select, button {
            display: block;
            margin: 5px 0;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            margin: 5px 0 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            background-color: #32cd32;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #228b22;
        }
        #searchResults div, #reviews div {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            background: #f8f8ff;
            border-radius: 5px;
        }
        .hidden {
            display: none;
        }
        .nav-buttons {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .nav-button {
            padding: 10px;
            background-color: #87cefa;
            color: white;
            border: none;
            cursor: pointer;
            margin: 5px;
            flex: 1;
            text-align: center;
            border-radius: 5px;
        }
        .nav-button:hover {
            background-color: #4682b4;
        }
        .emoji {
            font-size: 2em;
            text-align: center;
            margin-bottom: 20px;
        }
        .message {
            text-align: center;
            margin: 10px 0;
            color: #d9534f;
        }
        .section {
            display: none;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background-color: #fff;
        }
    </style>
</head>
<body>
    <h1>ğŸ“š ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ ğŸ“š</h1>

    <div class="emoji">ğŸ‘‹ ğŸŒ¸ ğŸ±</div>

    <div class="nav-buttons">
        <button class="nav-button" onclick="showSection('register')">íšŒì›ê°€ì…</button>
        <button class="nav-button" onclick="showSection('login')">ë¡œê·¸ì¸</button>
        <button class="nav-button" onclick="showSection('bookSearch')">ë„ì„œ ê²€ìƒ‰</button>
        <button class="nav-button" onclick="showSection('borrowedBooks')">ëŒ€ì¶œí•œ ë„ì„œ</button>
        <button class="nav-button" onclick="showSection('bookReview')">ë¦¬ë·° ì‘ì„±</button>
        <button class="nav-button" onclick="showSection('readingStats')">ë…ì„œ í†µê³„</button>
    </div>

    <!-- íšŒì›ê°€ì… í¼ -->
    <div id="register" class="section">
        <h2>íšŒì›ê°€ì…</h2>
        <form id="registerForm">
            <label for="username">ì•„ì´ë””:</label>
            <input type="text" id="username" name="username" required><br>
            <label for="password">ë¹„ë°€ë²ˆí˜¸:</label>
            <input type="password" id="password" name="password" required><br>
            <button type="submit">íšŒì›ê°€ì…</button>
        </form>
        <div id="registerMessage" class="message hidden"></div>
    </div>

    <!-- ë¡œê·¸ì¸ í¼ -->
    <div id="login" class="section">
        <h2>ë¡œê·¸ì¸</h2>
        <form id="loginForm">
            <label for="loginUsername">ì•„ì´ë””:</label>
            <input type="text" id="loginUsername" name="username" required><br>
            <label for="loginPassword">ë¹„ë°€ë²ˆí˜¸:</label>
            <input type="password" id="loginPassword" name="password" required><br>
            <button type="submit">ë¡œê·¸ì¸</button>
        </form>
        <div id="loginMessage" class="message hidden"></div>
    </div>

    <!-- ë„ì„œ ê²€ìƒ‰ -->
    <div id="bookSearch" class="section">
        <h2>ë„ì„œ ê²€ìƒ‰</h2>
        <form id="searchForm">
            <input type="text" id="searchQuery" name="query" placeholder="ì œëª©, ì €ì ë“±ìœ¼ë¡œ ê²€ìƒ‰" required>
            <button type="submit">ê²€ìƒ‰</button>
        </form>
        <div id="searchResults"></div>
    </div>

    <!-- ëŒ€ì¶œ ë„ì„œ ëª©ë¡ -->
    <div id="borrowedBooks" class="section">
        <h2>ëŒ€ì¶œí•œ ë„ì„œ</h2>
        <div id="borrowedBooksMessage" class="message hidden"></div>
        <ul id="borrowedBooksList">
            <!-- ëŒ€ì¶œí•œ ë„ì„œ ëª©ë¡ -->
        </ul>
    </div>

    <!-- ë¦¬ë·° ì‘ì„± -->
    <div id="bookReview" class="section">
        <h2>ë¦¬ë·° ì‘ì„±</h2>
        <form id="reviewForm">
            <label for="bookTitle">ë„ì„œ ì œëª©:</label>
            <input type="text" id="bookTitle" name="bookTitle" required><br>
            <label for="review">ë¦¬ë·°:</label>
            <textarea id="review" name="review" required></textarea><br>
            <label for="rating">í‰ì :</label>
            <select id="rating" name="rating" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select><br>
            <button type="submit">ë¦¬ë·° ì œì¶œ</button>
        </form>
        <div id="reviews"></div>
    </div>

    <!-- ë…ì„œ í†µê³„ -->
    <div id="readingStats" class="section">
        <h2>ë…ì„œ í†µê³„</h2>
        <p>ì´ ì½ì€ ë„ì„œ: <span id="totalBooksRead">0</span></p>
        <p>ê°€ì¥ ë§ì´ ì½ì€ ì¥ë¥´: <span id="mostReadGenre">N/A</span></p>
    </div>

    <script>
        let users = [];
        let loggedInUser = null;
        let totalBooksRead = 0;
        let genreCounts = {};
        let borrowedBooks = [];

        const books = [
            { title: 'ë¯¸ì›€ë°›ì„ ìš©ê¸°', author: 'ê¸°ì‹œë¯¸ ì´ì¹˜ë¡œ, ê³ ê°€ í›„ë¯¸íƒ€ì¼€', publisher: 'ë‹¤ì´ì•„ëª¬ë“œ ì‚¬', year: 2023, genre: 'í”½ì…˜, ì •ì‹ ë¶„ì„í•™' },
            { title: 'ë¶ˆí¸í•œ í¸ì˜ì ', author: 'ê¹€í˜¸ì—°', publisher: 'ë‚˜ë¬´ì˜†ì˜ì', year: 2021, genre: 'ë“œë¼ë§ˆ,ì½”ë¯¸ë””,íœ´ë¨¼' },
            { title: 'ì¹¨ë¬µì˜ ë´„', author: 'ë ˆì´ì²¼ ì¹´ìŠ¨', publisher: 'ì—ì½”ë¦¬ë¸Œë¥´', year: 2011, genre: 'í™˜ê²½' },
            { title: 'ìµœìœ ì§„ ìì„œì „', author: 'ìµœìœ ì§„', publisher: 'ìµœìœ ì§„', year: 2024, genre: 'ìì„œì „' },
            { title: 'ë…¸ì¸ê³¼ ë°”ë‹¤', author: 'ì–´ë‹ˆìŠ¤íŠ¸ í—¤ë°ì›¨ì´', publisher: 'ë¯¼ìŒì‚¬', year: 1952, genre: 'ì†Œì„¤' },
            { title: '1984', author: 'ì¡°ì§€ ì˜¤ì›°', publisher: 'ì—´ë¦°ì±…ë“¤', year: 1949, genre: 'ë””ìŠ¤í† í”¼ì•„' },
            { title: 'ì‚¬í”¼ì—”ìŠ¤', author: 'ìœ ë°œ í•˜ë¼ë¦¬', publisher: 'ê¹€ì˜ì‚¬', year: 2011, genre: 'ì—­ì‚¬' },
            { title: 'ì´, ê· , ì‡ ', author: 'ì¬ë ˆë“œ ë‹¤ì´ì•„ëª¬ë“œ', publisher: 'ë¬¸í•™ë™ë„¤', year: 1997, genre: 'ì¸ë¥˜í•™' },
            { title: 'ë°˜ì§€ì˜ ì œì™•', author: 'J.R.R. í†¨í‚¨', publisher: 'í™©ê¸ˆê°€ì§€', year: 1954, genre: 'íŒíƒ€ì§€' },
            { title: 'í•´ë¦¬ í¬í„°ì™€ ë§ˆë²•ì‚¬ì˜ ëŒ', author: 'J.K. ë¡¤ë§', publisher: 'ë¬¸í•™ë™ë„¤', year: 1997, genre: 'íŒíƒ€ì§€' },
        ];

        function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
        }

        function displayMessage(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.color = isError ? '#d9534f' : '#28a745';
            element.classList.remove('hidden');
        }

        function getDaysDiff(date1, date2) {
            const diffTime = Math.abs(date2 - date1);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function isBookOverdue(borrowedDate) {
            const today = new Date();
            const diffDays = getDaysDiff(new Date(borrowedDate), today);
            return diffDays > 14;
        }

        function updateBorrowedBooksList() {
            const borrowedBooksList = document.getElementById('borrowedBooksList');
            borrowedBooksList.innerHTML = '';
            borrowedBooks.filter(book => book.user === loggedInUser.username).forEach(book => {
                const listItem = document.createElement('li');
                const borrowedDate = new Date(book.borrowedDate);
                const returnDate = new Date(borrowedDate.getTime() + 14 * 24 * 60 * 60 * 1000);
                const today = new Date();
                const diffDays = getDaysDiff(today, returnDate);
                const dDay = diffDays >= 0 ? `D-${diffDays}` : `ì—°ì²´ ${-diffDays}ì¼`;

                listItem.textContent = `${book.title} (ë°˜ë‚© ì˜ˆì •ì¼: ${returnDate.toLocaleDateString()}, ${dDay})`;
                const returnButton = document.createElement('button');
                returnButton.textContent = 'ë°˜ë‚©';
                returnButton.onclick = () => returnBook(book.title);
                listItem.appendChild(returnButton);
                borrowedBooksList.appendChild(listItem);
            });
        }

        function borrowBook(bookTitle) {
            if (!loggedInUser) {
                displayMessage('borrowedBooksMessage', 'ë¨¼ì € ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.', true);
                showSection('login');
                return;
            }

            const alreadyBorrowed = borrowedBooks.some(book => book.user === loggedInUser.username && book.title === bookTitle);
            if (alreadyBorrowed) {
                alert('ì´ ë„ì„œëŠ” ì´ë¯¸ ëŒ€ì¶œí•˜ì…¨ìŠµë‹ˆë‹¤.');
                return;
            }

            const overdueBooks = borrowedBooks.filter(book => book.user === loggedInUser.username && isBookOverdue(book.borrowedDate));
            if (overdueBooks.length > 0) {
                displayMessage('borrowedBooksMessage', 'ì—°ì²´ëœ ë„ì„œê°€ ìˆì–´ ëŒ€ì¶œì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ì—°ì²´ëœ ë„ì„œë¥¼ ë°˜ë‚©í•´ ì£¼ì„¸ìš”.', true);
                return;
            }

            const userBorrowedBooks = borrowedBooks.filter(book => book.user === loggedInUser.username);
            if (userBorrowedBooks.length >= 4) {
                alert('ë„ì„œëŠ” ìµœëŒ€ 4ê¶Œê¹Œì§€ë§Œ ëŒ€ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            console.log(`ë„ì„œ ëŒ€ì¶œ: ${bookTitle}`);
            alert(`ëŒ€ì¶œ ì‹ ì²­: ${bookTitle}`);
            const borrowedDate = new Date();
            borrowedBooks.push({
                title: bookTitle,
                user: loggedInUser.username,
                borrowedDate: borrowedDate
            });

            // Update borrowed books list and stats
            updateBorrowedBooksList();
            const book = books.find(book => book.title === bookTitle);
            updateStats(bookTitle, book ? book.genre : 'ì†Œì„¤');
        }

        function returnBook(bookTitle) {
            if (!loggedInUser) {
                displayMessage('returnBooksMessage', 'ë¨¼ì € ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.', true);
                showSection('login');
                return;
            }
            console.log(`ë„ì„œ ë°˜ë‚©: ${bookTitle}`);
            alert(`ë°˜ë‚© ì‹ ì²­: ${bookTitle}`);

            // ëŒ€ì¶œí•œ ë„ì„œ ëª©ë¡ì—ì„œ ì œê±°
            borrowedBooks = borrowedBooks.filter(book => !(book.title === bookTitle && book.user === loggedInUser.username));

            // Update borrowed books list
            updateBorrowedBooksList();
        }

        document.getElementById('registerForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            users.push({ username, password });
            console.log(`íšŒì›ê°€ì…: ${username}`);
            displayMessage('registerMessage', 'íšŒì›ê°€ì…ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤!');
        });

        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const user = users.find(user => user.username === username && user.password === password);
            if (user) {
                loggedInUser = user;
                console.log(`ë¡œê·¸ì¸ ì„±ê³µ: ${username}`);
                displayMessage('loginMessage', 'ë¡œê·¸ì¸ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤!');
                updateBorrowedBooksList();
            } else {
                console.log(`ë¡œê·¸ì¸ ì‹¤íŒ¨: ${username}`);
                displayMessage('loginMessage', 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.', true);
            }
        });

        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const query = document.getElementById('searchQuery').value.toLowerCase();
            const results = books.filter(book => 
                book.title.toLowerCase().includes(query) || 
                book.author.toLowerCase().includes(query)
            );
            const searchResultsDiv = document.getElementById('searchResults');
            searchResultsDiv.innerHTML = '';
            if (results.length > 0) {
                results.forEach(book => {
                    const bookDiv = document.createElement('div');
                    bookDiv.innerHTML = `
                        <h3>${book.title}</h3>
                        <p>ì €ì: ${book.author}</p>
                        <p>ì¶œíŒì‚¬: ${book.publisher}</p>
                        <p>ì¶œíŒ ì—°ë„: ${book.year}</p>
                        <p>ì¥ë¥´: ${book.genre}</p>
                        <button onclick="borrowBook('${book.title}')">ëŒ€ì¶œ</button>
                    `;
                    searchResultsDiv.appendChild(bookDiv);
                });
            } else {
                searchResultsDiv.innerHTML = '<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        });

        function updateStats(bookTitle, genre) {
            totalBooksRead++;
            document.getElementById('totalBooksRead').textContent = totalBooksRead;
            if (genre in genreCounts) {
                genreCounts[genre]++;
            } else {
                genreCounts[genre] = 1;
            }
            const mostReadGenre = Object.keys(genreCounts).reduce((a, b) => genreCounts[a] > genreCounts[b] ? a : b);
            document.getElementById('mostReadGenre').textContent = mostReadGenre;
        }

        document.getElementById('reviewForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const bookTitle = document.getElementById('bookTitle').value;
            const review = document.getElementById('review').value;
            const rating = document.getElementById('rating').value;
            if (!loggedInUser) {
                alert('ë¦¬ë·°ë¥¼ ì‘ì„±í•˜ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.');
                showSection('login');
                return;
            }
            console.log(`ë¦¬ë·° ì‘ì„±: ${bookTitle}, ë¦¬ë·°: ${review}, í‰ì : ${rating}`);
            const reviewsDiv = document.getElementById('reviews');
            reviewsDiv.innerHTML += `
                <div data-title="${bookTitle}">
                    <h3>${bookTitle}</h3>
                    <p class="reviewText">ë¦¬ë·°: ${review}</p>
                    <p>í‰ì : ${rating}ì </p>
                    <p>ì‘ì„±ì: ${loggedInUser.username}</p>
                    <button onclick="editReview('${bookTitle}')">ìˆ˜ì •</button>
                    <button onclick="deleteReview('${bookTitle}')">ì‚­ì œ</button>
                </div>
            `;
        });

        function editReview(bookTitle) {
            const reviewDiv = document.querySelector(`#reviews div[data-title="${bookTitle}"]`);
            const reviewText = reviewDiv.querySelector('.reviewText').textContent;
            const newReview = prompt('ë¦¬ë·° ìˆ˜ì •:', reviewText);
            if (newReview !== null) {
                reviewDiv.querySelector('.reviewText').textContent = newReview;
                console.log(`ë¦¬ë·° ìˆ˜ì •: ${bookTitle}, ìƒˆ ë¦¬ë·°: ${newReview}`);
            }
        }

        function deleteReview(bookTitle) {
            const reviewDiv = document.querySelector(`#reviews div[data-title="${bookTitle}"]`);
            reviewDiv.remove();
            console.log(`ë¦¬ë·° ì‚­ì œ: ${bookTitle}`);
        }
    </script>
</body>
</html>